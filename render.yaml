services:
  # 1. Your Flask Backend Service
  - type: web
    name: paper-trading-backend
    runtime: docker
    plan: free
    dockerfilePath: backend.Dockerfile
    dockerContext: .
    envVars:
      # Render will automatically inject the DATABASE_URL for your PostgreSQL instance
      - key: DATABASE_URL
        fromDatabase:
          name: paper-trading-db
          property: connectionString
      # Reference the eventual public URL of your Nginx frontend
      - key: FRONTEND_URL
        fromService:
          name: paper-trading-frontend
          type: web
          property: host
    healthCheckPath: /health

  # 2. Your Nginx + React Frontend Service
  - type: web
    name: paper-trading-frontend
    runtime: docker
    plan: free
    dockerfilePath: ./nginx/Dockerfile
    dockerContext: .
    envVars:
      # Pass the backend's public hostname to the frontend build
      - key: VITE_API_URL
        fromService:
          name: paper-trading-backend
          type: web
          property: host

# 3. Your PostgreSQL Database
databases:
  - name: paper-trading-db
    plan: free